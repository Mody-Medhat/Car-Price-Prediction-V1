{% extends 'base.html' %}

{% block head %}
<title>ROYAL CARS - Car Rental HTML Template</title>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script> -->

{% endblock %}

{% block body %}
<div class="cont">
    <br>
    <h1 class="hea">
        <span>p</span>
        <span>r</span>
        <span>e</span>
        <span>d</span>
        <span>i</span>
        <span>c</span>
        <span>t</span>
    </h1>
    <hr>
    <!--  -->
    <div class="All_cont">
        <form method="post" accept-charset="utf-8" name="Modelform" onsubmit="return required()">
            <div class="form-row">
                <div class="form-group col-md-6">
                    <div class="first_line">
                        <span class="m_year_size">
                            <div class="first_second_line">
                                <label for="make">Brand</label>
                                <select class="form-control select2" name="make" id="make"
                                    onchange="load_car_models(this.id,'model', 'engine_fuel_type' , 'vehicle_style');AddOption()"
                                    required="1" style="background-color: #f7d8d3;">
                                    {% for make in makes %}
                                    <option value="{{ make }}">{{ make }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </span>

                        <span class="m_year_size">
                            <div class="first_second_line">
                                <label id="model_label" for="model">Model</label>
                                <select class="js-example-basic-single form-control selectpicker" , name="model"
                                    id="model"
                                    onchange="load_car_vehicle_style(this.id , 'vehicle_style');removeduplicate()"
                                    placeholder="Enter car Model" aria-label="Enter Latitude"
                                    style="background-color: #f7d8d3;" required="1">
                                    <!-- <option value="" selected disabled hidden>Choose here</option> -->

                                    <!-- <option value="" selected>Select Car Model</option> -->

                                </select>
                            </div>
                        </span>
                        <span class="m_year_size">
                            <div class="first_second_line">
                                <label id="year_label" for="year">Year</label>
                                <input class="date-own form-control" type="text" , name="year" id="year"
                                    placeholder="Enter Car Year" aria-label="Enter Car Year" min="1900" max="2099"
                                    style="background-color: #f7d8d3;">
                            </div>
                        </span>
                    </div>
                    <br />

                    <div class="first_line">
                        <span class="m_year_size">
                            <div class="first_second_line">
                                <label class="number_of_doors1" for="number_of_doors">Number Of Doors</label>
                                <label class="number_of_doors2" for="number_of_doors">N.OF.Doors</label>
                                <select class="form-control" name="number_of_doors" id="number_of_doors"
                                    placeholder="Enter Number Of Doors" aria-label="Enter Number Of Doors"
                                    style="background-color: #f7d8d3;">
                                    <option>2</option>
                                    <option>3</option>
                                    <option>4</option>
                                </select>
                            </div>
                        </span>
                        <span class="m_year_size">
                            <div class="first_second_line">
                                <label for="vehicle_style">Vehicle Style</label>
                                <select class="selectpicker form-control" name="vehicle_style" id="vehicle_style"
                                    placeholder="Enter Vehicle Style" aria-label="Enter Vehicle Style"
                                    style="background-color: #f7d8d3;">
                                </select>

                            </div>
                        </span>
                        <span class="m_year_size">
                            <div class="first_second_line">
                                <label for="vehicle_size">Vehicle Size</label>
                                <select class="selectpicker form-control" name="vehicle_size" id="vehicle_size"
                                    placeholder="Enter Vehicle Size" aria-label="Enter Vehicle Size"
                                    style="background-color: #f7d8d3;">
                                    {% for vehicle_size in vehicle_sizes %}
                                    <option value="{{ vehicle_size }}">{{ vehicle_size }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </span>
                    </div>
                    <br />

                    <div class="first_line">
                        <span class="driven_wheels">
                            <div class="first_second_line">
                                <label for="transmission_type">Transmission Type</label>
                                <select class="form-control" name="transmission_type" id="transmission_type"
                                    placeholder="Enter Transmission Type" aria-label="Enter Transmission Type"
                                    style="background-color: #f7d8d3;">
                                    <option value="automatic">Automatic</option>
                                    <option>Manual</option>
                                    <option>Automated Manual</option>
                                    <option>Direct Drive</option>
                                </select>
                            </div>
                        </span>
                        <span class="driven_wheels">
                            <div class="first_second_line">
                                <label for="driven_wheels">Driven Wheels</label>
                                <select class="form-control" name="driven_wheels" id="driven_wheels"
                                    placeholder="Enter Driven Wheels" aria-label="Enter Driven Wheels"
                                    style="background-color: #f7d8d3;">
                                    <option>Front Wheel Drive</option>
                                    <option>Rear Wheel Drive</option>
                                    <option>All Wheel Drive </option>
                                    <option>Four Wheel Drive</option>
                                </select>
                            </div>
                        </span>
                    </div>
                    <br />

                    <div class="first_line">
                        <span class="driven_wheels">
                            <div class="first_second_line">
                                <label id="engine_cylinders_label" for="engine_cylinders">Engine Cylinders</label>
                                <input class="form-control" type="number" , step="1" name="engine_cylinders"
                                    id="engine_cylinders" placeholder="Enter Engine Cylinders"
                                    aria-label="Enter Engine Cylinders" style="background-color: #f7d8d3;">
                            </div>
                        </span>
                        <span class="driven_wheels">
                            <div class="first_second_line">
                                <label id="engine_hp_label" for="engine_hp">Engine Horsepower</label>
                                <input class="form-control" type="number" , step="1" name="engine_hp" id="engine_hp"
                                    placeholder="Enter Engine Horsepower" aria-label="Enter Engine Horsepower"
                                    style="background-color: #f7d8d3;">
                            </div>
                        </span>
                    </div>
                    <br />
                    <div class="first_line">
                        <span class="driven_wheels">
                            <div class="first_second_line">
                                <label id="highway_mpg_label" for="highway_mpg">Highway MPG</label>
                                <input class="form-control" type="number" , step="1" name="highway_mpg" id="highway_mpg"
                                    placeholder="Enter Highway MPG" aria-label="Enter Highway MPG"
                                    style="background-color: #f7d8d3;">
                            </div>
                        </span>
                        <span class="driven_wheels">
                            <div class="first_second_line">
                                <label id="city_mpg_label" for="city_mpg">City MPG</label>
                                <input class="form-control" type="number" , step="1" name="city_mpg" id="city_mpg"
                                    placeholder="Enter City MPG" aria-label="Enter City MPG"
                                    style="background-color: #f7d8d3;">
                            </div>
                        </span>
                    </div>
                    <br />

                    <div class="first_line">
                        <div class="first_second_line">
                            <label for="engine_fuel_type">Engine Fuel Type</label>
                            <select class="form-control" name="engine_fuel_type" id="engine_fuel_type"
                                placeholder="Enter Engine Fuel Type" aria-label="Enter Engine Fuel Type"
                                style="background-color: #f7d8d3; width: 342px" required="1">
                            </select>
                        </div>

                        <div class="first_second_line">
                            <br />
                            <!-- <input class="btn btn-outline-warning btn-lg btn-block" type="submit" value="predict"
                                onclick="send_data()" style="margin-left: 29px;">  -->
                            <input class="btn btn-outline-warning btn-lg btn-block popup-btn" type="submit"
                                value="predict" onclick=" send_data();PrintData();changeImage()"
                                style="margin-left: 29px;">
                        </div>
                    </div>
                    <hr>
                    <div class="last_line">
                        <center>
                            <h5 style="color: #ffff;"> {{text}}
                                <strong style="color: rgb(255, 166, 0);" id="prediction"></strong>
                            </h5>
                        </center>
                    </div>
                </div>
            </div>
        </form>

        <div class="container1">
            <div class="product" id="DataPrint">
                <div class="popup-view">
                    <div class="popup-card">
                        <a><i class="fa fa-times close-btn"></i></a>
                        <div class="product-img">
                            <!-- <img src="{{ url_for('static', filename='logo/tesla-logo.png') }}" id="BrandImg" /> -->
                            <img src="../static/BrandImg/404 wanted.png" alt="Logo Not Found" id="BrandImg">
                        </div>
                        <div class="info">
                            <h2 id="makeData"></h2>
                            <span id="modelData" style="color: rgb(255, 166, 0);"></span>
                            <h5 style="color: rgb(255, 166, 0);" id="yearData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="engine_fuel_typeData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="engine_hpData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="engine_cylindersData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="transmission_typeData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="driven_wheelsData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="number_of_doorsData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="vehicle_sizeData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="vehicle_styleData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="highway_mpgData"></h5>
                            <h5 style="color: rgb(255, 166, 0);" id="city_mpgData"></h5>
                            <span class="price" style="color: rgb(255, 166, 0);" id="prediction"></span>
                            <!--<a href="#" class="add-cart-btn">Add to Cart</a>-->
                            <!--<a href="javascript:printDiv('DataPrint')" class="add-cart-btn" >Print</a><br>-->
                            <input type='button' value='Print Content' onclick='myApp.printDiv()' />
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <iframe name="print_frame" width="0" height="0" frameborder="0" src="about:blank"></iframe>
    </div>
</div>

<script>
    // $(function () {
    //     var model = document.getElementById("model").value;
    //     console.log(model)
    //     $("#model").val(model);
    // });
    // Use Select2 List TO Add Search to Normale Select List
    $(document).ready(function () {
        // Initialize select2
        $("#make").select2();
        $("#model").select2();
    });
    // Use Datapicker To Make Select Year DropDown
    $(document).ready(function () {
        $("#year").datepicker({
            format: "yyyy",
            viewMode: "years",
            minViewMode: "years",
            autoclose: true
        });
    })

    function load_car_models(make_id, model_id, fuel_type_id, vehicle_style_id) {
        var Make = document.getElementById(make_id);
        var car_model = document.getElementById(model_id);
        var fue_type = document.getElementById(fuel_type_id);
        var vehicle_style = document.getElementById(vehicle_style_id);
        // console.log(Make.value);
        car_model.value = "";
        car_model.innerHTML = "";
        fue_type.value = "";
        fue_type.innerHTML = "";
        vehicle_style.value = "";
        vehicle_style.innerHTML = "";
        {% for Make in makes %}
        if (Make.value == "{{ Make }}") {
            ImgName = Make.value + ".png"
            var src = "../static/BrandImg/" + ImgName;
            document.getElementById("BrandImg").src = src;
            console.log(ImgName)
            // model
            {% for model in models %}
            {% if Make in model %}
            var newOption = document.createElement("option");
            newOption.value = "{{ model }}";
            newOption.innerHTML = "{{ model }}";
            car_model.options.add(newOption);
            {% endif %}
            {% endfor %}
            // fuel type
            {% for fue_type in fuel_types %}
            {% if Make in fue_type %}
            var newOption = document.createElement("option");
            newOption.value = "{{ fue_type }}";
            {% for Engine_Fuel_Type in Engine_Fuel_Types %}
            {% if Engine_Fuel_Type in fue_type %}
            newOption.innerHTML = "{{ Engine_Fuel_Type }}";
            {% endif %}
            {% endfor %}
            fue_type.options.add(newOption);
            {% endif %}
            {% endfor %}

        }
        {% endfor %}
    }
    function load_car_vehicle_style(model_id, vehicle_style_id) {
        var car_model = document.getElementById(model_id);
        var vehicle_style = document.getElementById(vehicle_style_id);
        vehicle_style.value = "";
        vehicle_style.innerHTML = "";
        {% for car_model in models %}
        if (car_model.value == "{{ car_model }}") {
            //Vehicle Style
            {% for vehicle_style in vehicle_styles %}
            {% if car_model in vehicle_style %}
            var newOption = document.createElement("option");
            {% for car_style in car_styles %}
            {% if car_style in vehicle_style %}
            newOption.value = "{{ car_style }}";
            newOption.innerHTML = "{{ car_style }}";
            {% endif %}
            {% endfor %}
            vehicle_style.options.add(newOption);
            {% endif %}
            {% endfor %}
        }
        {% endfor %}

    }
    // Add Select Option To 'model' Select List
    function AddOption() {
        var model = document.getElementById("model");
        var option = document.createElement("option");
        option.text = "Select Car Model";
        model.add(option, model[0]);
        document.getElementById('model').value = 'Select Car Model';
    }
    // Remove Dublicated Value in 'vehicle_style' Select List
    function removeduplicate() {
        var mycode = {};
        $("select[id='vehicle_style'] > option").each(function () {
            if (mycode[this.text]) {
                $(this).remove();
            } else {
                mycode[this.text] = this.value;
            }
        });
    }

    function form_handler(event) {
        event.preventDefault(); // Don't submit the form normally
    }
    function send_data() {
        document.querySelector('form').addEventListener("submit", form_handler);

        var fd = new FormData(document.querySelector('form'));

        var xhr = new XMLHttpRequest({ mozSystem: true });

        xhr.open('POST', '/predict', true);
        document.getElementById('prediction').innerHTML = "Wait! Predicting Price.....";
        xhr.onreadystatechange = function () {
            if (xhr.readyState == XMLHttpRequest.DONE) {
                document.getElementById('prediction').innerHTML = xhr.responseText;
            }
        };

        xhr.onload = function () { };

        xhr.send(fd);
    }
</script>

{% endblock %}